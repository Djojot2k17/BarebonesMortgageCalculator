<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
    />
    <!-- Google Fonts -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    />
    <!-- Bootstrap core CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Material Design Bootstrap -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="//cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css"
      integrity="sha512-/zs32ZEJh+/EO2N1b0PEdoA10JkdC3zJ8L5FTiQu82LR9S/rOQNfQN7U59U9BC12swNeRAz3HSzIL2vpp4fv3w=="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="Css/prism.css">
    <!-- <script src="Scripts/jspdf.es.js"></script> -->
    <script src="Scripts/html2pdf.bundle.min.js"></script>

    <link rel="stylesheet" href="styles.css" />
    <title>Dragon Mortgage Calculator</title>
  </head>
  <body>
    <!-- <div class="container text-center"> -->
    <!-- <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container">
          <a class="navbar-brand" href="index.html"
            ><img
              src="Images/dragonfavicon.png"
              alt=""
              width="50"
              height="50"
              class="d-inline-block align-middle"
            /><span id="logoText">Dragon Mortgage Calculator</span></a
          >
          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item">
                <a class="nav-link" href="#"
                  >Home <span class="sr-only">(current)</span></a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Formulas</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Github</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!- /.Navbar -->
    <!--START LANDING-->
    <!-- <div id="landing" class="extraPadding">
        <div class="row p-5"> -->
    <!-- first card -->
    <!-- <div class="col">
            <h1 class="display-3">Welcome to Dragon Mortgage!</h1>
            <h4 class="myFont font-italic">
              We make mortgage calculations simple<br />
              one step at a time.
            </h4>
            <img src="Images/dragonfavicon.png" />
          </div> -->
    <!-- end first card -->
    <!-- </div>
        <div class="row"> -->
    <!-- second card -->
    <!-- <div class="col">
            <div class="niceCard mb-5 testy2">
              <h3 class="mb-3 ml-4 myFont">Our Calculator will:</h3>
              <p class="mb-3">
                Give you the information to understand exactly how your mortgage
                works.
              </p>
              <h4>
                Give you the tools to plan exactly how you want to tackle it.
              </h4>
            </div>
          </div> -->
    <!-- end second card -->
    <!-- <div class="col">
            <img src="Images/test.gif" class="testy" width="500" />
          </div>
        </div>
        <div class="row">
          <div class="col ml-5">
            <h5 style="color: #101329">
              Click the arrow and we'll get you started!
            </h5>
          </div>
        </div> -->
    <!-- END LANDING -->
    <div class="container-fluid">
      <!-- CALCULATOR -->
      <h1 class="m-5 text-center">Mortgage Calculator</h1>
      <p>
        This is a weekend project I did with a couple of guys from Coder
        Foundry. It's a simple Mortgage Calculator.
      </p>
      <p>Step 1: Move the Home Price slider.</p>
      <p>
        Step 2: Adjust the Down Payment, Length of the Loan, and Interest Rate
      </p>
      <p>Step 3: Click on 'Details'</p>
      <p>This generates a chart using the selected Date as a starting point.</p>
      <p>Technologies used: Html, CSS, JavaScript, and ChartJs</p>
      <div class="row pl-2">
        <div class="col-md-4 border rounded p-3 mb-5">
          <h3 class="text-center pb-3">Initial Transaction</h3>
          <div class="input-group mb-3 md-form">
            <div class="input-group-prepend">
              <span class="input-group-text md-addon">Home Price</span>
            </div>
            <input
              class="form-control"
              type="text"
              id="homePrice"
              placeholder="Numbers only please..."
              value="$ 50,000"
            />
            <input
              type="range"
              class="custom-range"
              min="50000"
              max="1250000"
              step="1000"
              value="50000"
              id="homePriceRange"
            />
          </div>
          <div class="input-group mb-3 md-form">
            <span class="input-group-text md-addon">Down Payment</span>
            <input
              class="form-control"
              type="text"
              id="downPayment"
              placeholder="Down Payment"
              value="$ 10,000"
              disabled
            />
          </div>
          <div class="input-group mb-3 md-form">
            <span class="input-group-text md-addon">Down Payment %</span>
            <input
              class="form-control"
              type="number"
              id="dpPercentage"
              placeholder="Percentage"
              value="20"
            />
          </div>

          <h3 class="text-center pt-3">Loan Details</h3>
          <hr />
          <div class="input-group mb-3 md-form">
            <span class="input-group-text md-addon">Loan Amount</span>
            <input
              class="form-control"
              type="text"
              id="loanAmount"
              placeholder="Loan amount"
              value="$ 40,000"
              disabled
            />
          </div>
          <div class="input-group mb-3 md-form">
            <span class="input-group-text md-addon">Length of Loan</span>
            <select class="custom-select" id="term">
              <option value="10">10 Years</option>
              <option value="15">15 Years</option>
              <option selected value="30">30 Years</option>
            </select>
          </div>
          <div class="input-group mb-3 md-form">
            <span class="input-group-text md-addon">Interest Rate %</span>
            <input
              class="form-control"
              type="number"
              id="interestRate"
              value="4"
              step=".1"
            />
          </div>

          <div class="input-group mb-3 md-form">
            <span class="input-group-text md-addon"
              >Estimated Monthly Payment</span
            >
            <input
              class="form-control"
              type="text"
              id="estimatedMonthlyPayment"
              value="$ 190"
              disabled
            />
          </div>
          <div class="input-group mb-3">
            <span class="input-group-text md-addon" id="startDateLabel"
              ><strong>Mortage Start Date:</strong></span
            >
            <input class="form-control" type="date" id="mortgageStartDate" />
          </div>
          <span class="btn btn-info d-block" id="detailsButton">
            <i class="fas fa-table mr-3"></i> Details
          </span>
        </div>
        <div class="col-md-8">
          <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <a
                class="nav-link active"
                id="home-tab"
                data-toggle="tab"
                href="#schedule"
                role="tab"
                aria-controls="schedule"
                aria-selected="true"
                >Amortization Schedule</a
              >
            </li>
            <li class="nav-item" role="presentation">
              <a
                class="nav-link"
                id="schedule-tab"
                data-toggle="tab"
                href="#amoChart"
                role="tab"
                aria-controls="amoChart"
                aria-selected="false"
                >Amortization Chart</a
              >
            </li>
            <li class="nav-item" role="presentation">
              <a
                class="nav-link"
                id="pdf-tab"
                data-toggle="tab"
                role="tab"
                href="#pdf"
                aria-controls="pdf"
                aria-selected="false"
                >Download PDF</a
              >
            </li>
            <li class="nav-item" role="presentation">
              <a
                class="nav-link"
                id="code"
                data-toggle="tab"
                role="tab"
                href="#code-tab"
                aria-controls="code"
                aria-selected="false"
                >Code</a
              >
            </li>
          </ul>
          <div class="tab-content" id="myTabContent">
            <div
              class="tab-pane fade show active"
              id="schedule"
              role="tabpanel"
              aria-labelledby="schedule-tab"
            >
              <div class="tableContainer">
                <table id="calculatedTable">
                  <thead>
                    <th scope="col">Date</th>
                    <th scope="col">Balance</th>
                    <th scope="col">Monthly Payment</th>
                    <th scope="col">Principal paid</th>
                    <th scope="col">Interest paid</th>
                    <th scope="col">Principal to Date</th>
                    <th scope="col">Interest to Date</th>
                  </thead>
                  <tbody id="tableBody"></tbody>
                </table>
              </div>
            </div>
            <div
              class="tab-pane fade"
              id="amoChart"
              role="tabpanel"
              aria-labelledby="amoChart-tab"
            >
              <canvas id="tableInfo"></canvas>
            </div>
            <div
              class="tab-pane fade"
              id="pdf"
              role="tabpanel"
              aria-labelledby="pdf-tab"
            >
              <p class="lead m-5 text center">
                Please make sure you hit 'Details' before attempting to
                download.
              </p>
              <button onclick="savePdf()" class="btn btn-info btn-block">
                Download Doc
              </button>
            </div>
            <div
              class="tab-pane fade"
              id="code-tab"
              role="tabpanel"
              aria-labelledby="code-tab"
            >
            <p class="pt-2">Since I did the JavaScript portion of this project, I thought I'd explain how I got this to work.</p>
            <p>After having declared and added event listeners to all the inputs, we needed to do the calculations.</p>
            <div style="height: 630px; overflow-y: auto;">
            <pre>
              <code class="language-javascript line-numbers">
detailButton.addEventListener("click", () => {
  // Grab all the data currently in our calculator
  let hp = numberWithoutCommas(homePrice.value); // NumbersWithoutCommas is a simple regex
  let dp = numberWithoutCommas(downpayment.value); // that gets rid of commas
  let dpp = dpPercentage.value; // some of these live outside this function's scope

  let loan = parseFloat(numberWithoutCommas(loanAmount.value));
  let term = years.value;
  let termInMonths = term * 12;
  let interest = parseFloat(interestRate.value);
  displayMonthlyPayment(hp, dp, term, interest); // Make sure we have the latest values
  let monthly = parseFloat(monthlyAccurate); 
  let startDate = mortgageStartDate.value;
  let table = document.getElementById("tableBody");

  // Reset table every click
  table.innerHTML = "";

  // Set an empty table and year array
  let tableArray = [];
  let yearArray = [];

  // balance = Loan - principal paid for current month
  // monthly payment = principal paid for current month + interest per month
  // principal paid for current month = monthly payment - interest per month
  // interest per month = balance * rate / 1200
  // principal paid to date = sum of all principal
  // interest to date = sum of all interest

  // Set a starting object to do our calculations on
  let ct = {
    balance: loan,
    monthlyPayment: monthly,
    principalPaid: 0,
    interestPaid: (loan * interest) / 1200,
    principalToDate: 0,
    interestToDate: 0,
  };

  // Loop through the term in months and apply the calculations to the ct object on each pass.

  for (let i = 0; i <= termInMonths; i++) {
    ct.balance = ct.balance - ct.principalPaid; // OK
    ct.monthlyPayment = monthly; // OK
    ct.interestPaid = (ct.balance * interest) / 1200;
    ct.principalPaid = ct.monthlyPayment - ct.interestPaid;
    ct.principalToDate += ct.principalPaid;
    ct.interestToDate += ct.interestPaid;

    // Populate the table array with the objects we'll use for displaying the table.
    tableArray.push({
      balance: ct.balance,
      monthlyPayment: ct.monthlyPayment,
      principalPaid: ct.principalPaid,
      interestPaid: ct.interestPaid,
      principalToDate: ct.principalToDate,
      interestToDate: ct.interestToDate,
    });
  }

  // Because we're using a date based loop, we need to create an array of Date objects.
  // Set an empty array to push our dates to
  let dateArray = [];

  // Set start date
  let d1 = new Date(startDate);
  // Add one to days (damn 0 indexed values)
  d1.adjust("days", 1); // .adjust and .each are separate functions I'll display below.
  // Set end date
  let d2 = new Date();
  d2.adjust("months", termInMonths + 1);
  // Set output to push to our dateArray
  let output = "";
  // Had to have a separate output for the years in chartJs
  let output2 = "";
  // loop by months
  d1.each(d2, "months", 1, function (currentDate, currentStep, thisDate) {
    // output = mm/dd/yyyy
    output = `${new Date(currentDate).getMonth() + 1}/${new Date(currentDate).getDate()}/
      ${new Date(currentDate).getFullYear()}`;

    // Until we get to the date of termInMonths, push output to array
    dateArray.push(output);
    output2 = `${new Date(currentDate).getFullYear()}`; // output2 = yyyy
    yearArray.push(output2);
  });

  // Total principal cannot be greater than original balance (loan)
  // Js had us bangin our heads against a wall tryin to figure this one out
  // Just replace the very last value with the previous value and voila.
  tableArray[tableArray.length - 1].principalToDate =
    tableArray[tableArray.length - 2].principalToDate;

  // Set ChartJs empty data and color arrays
  let balanceData = [];
  let balanceBgColor = [];
  let balanceBorder = [];
  let principalData = [];
  let principalBgColor = [];
  let principalBorder = [];
  let interestData = [];
  let interestBgColor = [];
  let interestBorder = [];

  // Loop through the date array and get the html element to populate with data.
  for (let i = 0; i < dateArray.length; i++) {
    // numbersWithCommas is a regext that adds commas back in
    table.innerHTML += `
    &lt;tr&gt;
      &lt;td&gt;${dateArray[i]}&lt;/td&gt;
      &lt;td&gt;$ ${numberWithCommas(tableArray[i].balance.toFixed(2))}&lt;/td&gt;
      &lt;td&gt;$ ${numberWithCommas(tableArray[i].monthlyPayment.toFixed(2))}&lt;/td&gt;
      &lt;td&gt;$ ${numberWithCommas(tableArray[i].principalPaid.toFixed(2))}&lt;/td&gt;
      &lt;td&gt;$ ${numberWithCommas(tableArray[i].interestPaid.toFixed(2))}&lt;/td&gt;
      &lt;td&gt;$ ${numberWithCommas(tableArray[i].principalToDate.toFixed(2))}&lt;/td&gt;
      &lt;td&gt;$ ${numberWithCommas(tableArray[i].interestToDate.toFixed(2))}&lt;/td&gt;
    &lt;/tr&gt;`;

    // Also set the colors for ChartJs
    balanceData.push(Number(tableArray[i].balance.toFixed(2)));
    balanceBgColor.push("rgba(255, 99, 132, 0.2)");
    balanceBorder.push("rgba(200, 99, 132, 1)");
    principalData.push(Number(tableArray[i].principalToDate.toFixed(2)));
    principalBgColor.push("rgba(7, 141, 14, 0.2)");
    principalBorder.push("rgba(7, 141, 14, 1)");
    interestData.push(Number(tableArray[i].interestToDate.toFixed(2)));
    interestBgColor.push("rgba(13, 103, 177, 0.2)");
    interestBorder.push("rgba(13, 103, 177, 1)");
  }

  // Fade the table in
  setTimeout(() => {
    $(".tableContainer").fadeIn(500);
    $("#tableInfo").fadeIn(500);
  }, 1000);

  // Populate ChartJs object
  let chartData = {
    type: "bar",
    data: {
      labels: yearArray,
      datasets: [
        {
          label: "Balance",
          data: balanceData,
          backgroundColor: balanceBgColor,
          borderColor: balanceBorder,
          borderWidth: 0.5,
        },
        {
          label: "Principal to Date",
          data: principalData,
          backgroundColor: principalBgColor,
          borderColor: principalBorder,
          borderWidth: 0.5,
        },
        {
          label: "Interest to Date",
          data: interestData,
          backgroundColor: interestBgColor,
          borderColor: interestBorder,
          borderWidth: 0.5,
        },
      ],
    },
    options: {
      tooltips: {
        mode: "index",
        intersect: false,
      },
      scales: {
        yAxes: [
          {
            ticks: {
              beginAtZero: true,
            },
            gridLines: {
              display: false,
            },
          },
        ],
        xAxes: [{ gridLines: { display: false } }],
      },
    },
  };

  // Get rid of the previous chart on page refresh.
  if (window.myChart !== undefined) {
    window.myChart.destroy();
  }
  // Draw the chart
  var ctx = document.getElementById("tableInfo").getContext("2d");
  window.myChart = new Chart(ctx, chartData, {
    responsive: true,
  });
});

// This is how I did the Date.adjust and Date.each functions
// Props to Kentrichardson.com for providing these awesome functions
// Allows simple adjustments to the Date object

Date.prototype.adjust = function (part, amount) {
  part = part.toLowerCase();

  let map = {
      years: "FullYear",
      months: "Month",
      weeks: "Hours",
      days: "Hours",
      hours: "Hours",
      minutes: "Minutes",
      seconds: "Seconds",
      milliseconds: "Milliseconds",
      utcyears: "UTCFullYear",
      utcmonths: "UTCMonth",
      weeks: "UTCHours",
      utcdays: "UTCHours",
      utchours: "UTCHours",
      utcminutes: "UTCMinutes",
      utcseconds: "UTCSeconds",
      utcmilliseconds: "UTCMilliseconds",
    },
    mapPart = map[part];

  if (part == "weeks" || part == "utcweeks") amount *= 168;
  if (part == "days" || part == "utcdays") amount *= 24;

  this["set" + mapPart](this["get" + mapPart]() + amount);

  return this;
};

// Basically Date.forEach() from date x to date y. Calculates for leap years
Date.prototype.each = function (endDate, part, step, fn, bind) {
  let fromDate = new Date(this.getTime()),
    toDate = new Date(endDate.getTime()),
    pm = fromDate <= toDate ? 1 : -1,
    i = 0;

  while (
    (pm === 1 && fromDate <= toDate) ||
    (pm === -1 && fromDate >= toDate)
  ) {
    if (fn.call(bind, fromDate, i, this) === false) break;
    i += step;
    fromDate.adjust(part, step * pm);
  }
  return this;
};
              </code>
            </pre>
            </div>
          </div>
        </div>
      </div>
      <!-- END CALCULATOR -->
      <!-- DATA BREAKDOWN -->
      <!-- SummayView -->

      <!-- TABLE -->
    </div>

    <!-- JQuery -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
    ></script>
    <!-- Bootstrap tooltips -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"
    ></script>
    <!-- Bootstrap core JavaScript -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js"
    ></script>
    <!-- MDB core JavaScript -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js"
    ></script>
    <script src="//cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script src="Scripts/prism.js"></script>

    <script src="Scripts/jquery.slimscroll.min.js"></script>
    <script src="Scripts/app.js"></script>

    <script>
      function demoFromHTML() {
        var pdf = new jsPDF("p", "pt", "letter");
        // source can be HTML-formatted string, or a reference
        // to an actual DOM element from which the text will be scraped.
        source = $("#content")[0];
        // we support special element handlers. Register them with jQuery-style
        // ID selector for either ID or node name. ("#iAmID", "div", "span" etc.)
        // There is no support for any other type of selectors
        // (class, of compound) at this time.
        specialElementHandlers = {
          // element with id of "bypass" - jQuery style selector
          "#bypassme": function (element, renderer) {
            // true = "handled elsewhere, bypass text extraction"
            return true;
          },
        };
        margins = {
          top: 80,
          bottom: 60,
          left: 40,
          width: 522,
        };
        // all coords and widths are in jsPDF instance's declared units
        // 'inches' in this case
        pdf.fromHTML(
          source, // HTML string or DOM elem ref.
          margins.left, // x coord
          margins.top,
          {
            // y coord
            width: margins.width, // max width of content on PDF
            elementHandlers: specialElementHandlers,
          },
          function (dispose) {
            // dispose: object with X, Y of the last line add to the PDF
            //          this allow the insertion of new lines after html
            pdf.save("Test.pdf");
          },
          margins
        );
      }
    </script>

    <!-- CustomJS -->
    <script src="myjs.js"></script>
  </body>
</html>
